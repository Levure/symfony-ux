I have a crazy idea. What if, when the user hovers over a little, like we prefetch, that you were out and saved it as a snapshot cash, then assuming the user does click that link turbo would show this page instantly from its preview. Is that possible? It is well not officially interval, but thanks to some clever people on the internet. It is. If you download the course code, you should have a tutorial directory with a prefetch dot JS file inside. Copy that and paste it into our turbo directory. Okay. This isn't not my script. It comes from a gist that I attributed up on top. This script automatically makes an Ajax call whenever a user hovers over an anchor tab and saves that as a turbo snapshot. Then when you click, you instantly see the preview for a super fast navigating experience, like instant to avoid totally spamming the server with requests, the code waits for you to hover for 65 milliseconds before sending the Ajax request. This approach does have some downsides, but let's see it in action. First, open up app dot JS, and import this import dot slash turbo slash prefetch. That's enough to activate it. Also open up styles slash app that CSS and coming out in the opacity transition that we added before the page are going to be so instant that this won't be needed.

Okay. Moment of truth. However, refresh. And I'm just going to kind of casually click down here on furniture. How fast that was. All these pages are now loading as if I've already visited them before. The thing is now super fast and my site, okay. That was too easy. So what are the downsides? There are a few. The first is that your site is going to get hit by a lot more requests. If you hover over a link button, never click it. That's an extra request, but worse. Even if you do click the link, two requests are made watch. I'm going to refresh then clear my network tools down here. All right. So I'll have our office supplies then quick, check it out. Two requests for the same page on top

[inaudible]

The prefetch script made the first request to store it as a snapshot for the preview, but like normal preview functionality. After showing the preview a second request was made to load the page fresh. That's a bummer. Another downside is that unless your pages load fast enough, this won't make a difference. So for example, let me clear this again. If I hover over break room and click it really quickly before the age has called finished it's we're not going to get the nice behavior. You still see that took a second to load that's because the first prefect H request hadn't finished by the time I started the second one [inaudible]

[inaudible]

In fact, it's stalled the request that actually the second request had to wait for the first to load. She's totally a problem. The last problem is that our prefetch script also includes things like log out length. So if I, however long outline this script here is not going to know is going to request that and it's going to log me out. We don't really want log out links to be visited. So this is really cool, but be careful. You can add a, I search it for dataset. You can add a data dash prefetch equals a false to any URL to disable it, or with a little bit of customization to the script. You could disable the behavior by the faults and only enable it. If a link has data that's prefetch equals true. You just change this line right here.

Now allow you to, prefetch just the most likely pages or a third option, which you can see in the bottom here is to add a data prefetch with link equals true attribute, which adds a link element to your head. What does that do? Okay, great question. Let's back up a little bit so far, this whole prefetch script here is pure turbo magic or making an Ajax call down here and actually leveraging turbo is a snapshot cash, but your browser actually has a prefetch feature built into it. And that's what this data prefetch with. Link attribute is leveraging to see how it works. Let's actually close this prefetch script and comment at out.

Okay. I want to show you how true prefetching works without any turbo magic, because prefetching can be used on any site, even if you don't have turbo. Here's the deal. Imagine that when you go to a certain page on your site, you were fairly sure that you know what the next page or pages will be, that the user will go to. In that case, you can hint to the user's browser, that if it has extra time, it can prefetch that URL so that if the user does navigate to it, it will load instantly from cache. For example, let's add an item to our cart and then had to the shopping cart page.

It might be obvious that once a user is on this page, they usually click this checkout link. Let's add a hint that the browser can prefetch that how open the temple for this page? So that's templates cart carved out age twig, and up on top override, a blocked called metas. This is not a standard at blocking symphony. Uh, but earlier in the tutorial, in based at age two months, we, we added it. So we can inside of here add link instead of rallying call style sheet, say WRAL equals prefetch. And then for the age rap, I'll say curly curly path, and then the route to the checkout pages app underscore checkout.

That's it let's go see what happens or here, I'm going to refresh the page on the network tools. Let's click to see all and then scroll to the top. And there's the cart, original quest, but scroll down there. It is check out. Okay. Hey, checkout requests that took a 360 milliseconds that is thanks to the prefetch. Now the requests and click at checkout. Scroll up to the top of the requests. Cool. When turbo made the AGS call for this page, our browser was smart enough to instantly pull it from the prefetch cache. Let me get my mouse out of the way there, making your page load even faster. So this isn't as fancy as the automatic is the isn't quite isn't as fancy or quite as fast as the hover prefetch, but it works without any extra requests. Could you combine these two approaches or, or stop fewer extra requests?

Could we on the hover add a prefetch link tag? Yep. That's what the data dash prefetch dash with dash link attribute does. And there are other tiny libraries. One is called instant page that also does this because this idea of adding a prefetch link, when you hover over a link has nothing to do with turbo, but the devil is in the details. Whenever we navigate to a new page removes any, uh, prefetch link tags that are in the head, that's just how turbo looks. So if we go to the shopping cart page and go to elements, we're going to see, whereas city on here, our link rally was pretty fetch. Actually. I want me to refresh just so we don't have any surprises about link. Really? It was prefetch. So that's on there and we've not prepared that you were out, but when we clicked to a different page, like a shopping cart page, that link rally up was, is gone.

Oh, I'm back on the card again. Here we go. Let me actually go to the homepage. There we go. You can see the link rally goes prefetch is gone, which means even though our browser technically has prefetch that you were out, our browser forgot that we preached it. Okay. So this is the tricky part. The prefetch on hover works really well, but you will prefetch URLs over and over and over again on necessarily because they'll be taken out of your head tag. So I know this got a little bit hairy with all this. It's just so cool. The stuff you can do, but the takeaway is that even though these are really cool and they can make you say it really, really fast, none of these options are perfect yet. So use them wisely on my side. I'd probably use an opt-in an opt in approach. One that leverages the prefetch link on hubber of just certain, uh, URLs. Okay. Then we're done with turbo drive. Let's turn a turbo frame, a feature that allows us to separate our site into little pieces each, which navigates independently.

